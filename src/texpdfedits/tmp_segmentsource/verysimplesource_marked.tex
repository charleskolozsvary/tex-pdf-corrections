\documentclass{amsart}

\newwrite\markfile
\immediate\openout\markfile=boxpositions_verysimplesource.txt

\newcommand{\markbox}[2]{%
  \setbox0=\hbox{#2}%
  \immediate\write\markfile{#1:whd{}:\the\value{page}:\the\wd0:\the\ht0:\the\dp0}%
  \pdfsavepos
  \write\markfile{#1:start:\the\value{page}:\the\pdflastxpos:\the\pdflastypos}%
  #2% 
  \pdfsavepos
  \write\markfile{#1:end{}:\the\value{page}:\the\pdflastxpos:\the\pdflastypos}%
}

\begin{document}
Here \markbox{0}{is} \markbox{1}{just} \markbox{2}{some} \markbox{3}{straight} \markbox{4}{up} text, \markbox{5}{no} \markbox{6}{math} \markbox{7}{or} \markbox{8}{equations} \markbox{9}{or} anything. \markbox{10}{I} \markbox{11}{just} \markbox{12}{want} \markbox{13}{to} \markbox{14}{see} \markbox{15}{if} \markbox{16}{I} \markbox{17}{can} \markbox{18}{visualize} \markbox{19}{the} \markbox{20}{information} \markbox{21}{that} \markbox{22}{is} \markbox{23}{output} \markbox{24}{to} {\tt boxpositions\_\string{filename\string}.txt} \markbox{25}{without} \markbox{26}{writing} \markbox{27}{a} \markbox{28}{huge} \markbox{29}{file} \markbox{30}{and} \markbox{31}{drawing} \markbox{32}{a} \markbox{33}{bunch} \markbox{34}{of} \markbox{35}{rectangles} \markbox{36}{for} \markbox{37}{all} \markbox{38}{the} \markbox{39}{different} words. I'll \markbox{40}{also} \markbox{41}{need} \markbox{42}{to} \markbox{43}{think} \markbox{44}{a} \markbox{45}{little} \markbox{46}{more} \markbox{47}{clearly} \markbox{48}{on} \markbox{49}{how} \markbox{50}{exactly} \markbox{51}{I} \markbox{52}{intend} \markbox{53}{to} \markbox{54}{use} \markbox{55}{all} \markbox{56}{the} \markbox{57}{information} \markbox{58}{in} \markbox{59}{that} {\tt boxpositions\_\string{filename\string}.txt} file. Let's \markbox{60}{do} \markbox{61}{that} now---why not. \markbox{62}{So} \markbox{63}{in} \markbox{64}{theory} \markbox{65}{the} \markbox{66}{information} \markbox{67}{this} \markbox{68}{gives} \markbox{69}{me} is
\begin{enumerate}
\item the width, height, \markbox{70}{and} \markbox{71}{depth} \markbox{72}{of} \markbox{73}{words} \markbox{74}{in} \markbox{75}{the} \markbox{76}{source} \markbox{77}{that} \markbox{78}{are} \markbox{79}{not} \markbox{80}{inside} \markbox{81}{forbidden} \markbox{82}{environments} \markbox{83}{or} \markbox{84}{a} \markbox{85}{naked} \markbox{86}{block} \markbox{87}{and} \markbox{88}{are} \markbox{89}{surrounded} \markbox{90}{by} \markbox{91}{just} space, \markbox{92}{no} punctuation.
\item the \markbox{93}{start} \markbox{94}{and} \markbox{95}{end} \markbox{96}{x} \markbox{97}{and} \markbox{98}{y} \markbox{99}{coordinate} \markbox{100}{of} \markbox{101}{the} \markbox{102}{word} \markbox{103}{in} \markbox{104}{the} PDF: \markbox{105}{I} \markbox{106}{should} \markbox{107}{be} \markbox{108}{able} \markbox{109}{to} \markbox{110}{to} \markbox{111}{use} \markbox{112}{this} \markbox{113}{to} \markbox{114}{get} \markbox{115}{the} word's x0 \markbox{116}{and} x1 \markbox{117}{rectangle} \markbox{118}{in} \markbox{119}{the} PDF
\item the \markbox{120}{start} \markbox{121}{and} \markbox{122}{end} \markbox{123}{page} \markbox{124}{of} \markbox{125}{the} \markbox{126}{word} \markbox{127}{in} \markbox{128}{the} PDF
\end{enumerate}
I \markbox{129}{believe} \markbox{130}{the} \markbox{131}{start} \markbox{132}{and} \markbox{133}{end} \markbox{134}{y} \markbox{135}{coordinates} \markbox{136}{are} \markbox{137}{always} \markbox{138}{the} \markbox{139}{same} \markbox{140}{unless} \markbox{141}{the} \markbox{142}{word} \markbox{143}{spans} \markbox{144}{a} \markbox{145}{newline} \markbox{146}{or} pagebreak, \markbox{147}{which} \markbox{148}{might} \markbox{149}{be} \markbox{150}{worth} using? \markbox{151}{Or} \markbox{152}{maybe} I'll \markbox{153}{just} \markbox{154}{ignore} those? \markbox{155}{Ultimately} \markbox{156}{I} \markbox{157}{want} \markbox{158}{some} \markbox{159}{funciton} \markbox{m160}{$f$} \markbox{161}{where} \markbox{m162}{$f(\text{rectangle in PDF} = \text{the source LaTeX which created and/or is very near that rectangle}$}. So\dots.

Okay! \markbox{163}{This} \markbox{164}{might} \markbox{165}{be} overkill, \markbox{166}{but} \markbox{167}{we} \markbox{168}{could} \markbox{169}{do} \markbox{170}{something} \markbox{171}{like} this:
Given \markbox{172}{an} \markbox{173}{arbitrary} \markbox{174}{page} \markbox{175}{and} \markbox{176}{rectangle} \markbox{177}{specified} \markbox{178}{by} x0, y0, x1, y1 \markbox{179}{see} \markbox{180}{which} \markbox{181}{individual} \markbox{182}{word} \markbox{183}{rectangles} \markbox{184}{on} \markbox{185}{that} \markbox{186}{page} \markbox{187}{the} \markbox{188}{larger} \markbox{189}{rectangle} intersects.

Then \markbox{190}{identify} \markbox{191}{the} \markbox{192}{intersecting} \markbox{193}{word} \markbox{194}{rectangle} \markbox{195}{that} \markbox{196}{is} \markbox{197}{earliest} \markbox{198}{in} \markbox{199}{the} \markbox{200}{page} (smallest y0 \markbox{201}{then} x0---I \markbox{202}{believe} \markbox{203}{a} \markbox{204}{larger} \markbox{205}{y} \markbox{206}{coordinate} \markbox{207}{means} \markbox{208}{further} \markbox{209}{down} \markbox{210}{the} page; it's \markbox{211}{not} \markbox{212}{the} \markbox{213}{usual} \markbox{214}{cartesian} \markbox{215}{coordinate} system) \markbox{216}{and} \markbox{217}{the} \markbox{218}{one} \markbox{219}{which} \markbox{220}{is} \markbox{221}{last} \markbox{222}{in} \markbox{223}{the} \markbox{224}{page} (largest y1 \markbox{225}{and} \markbox{226}{then} \markbox{227}{largest} x1) \markbox{228}{and} \markbox{229}{then} \markbox{230}{just} \markbox{231}{grab} \markbox{232}{all} \markbox{233}{of} \markbox{234}{the} \LaTeX{} \markbox{235}{source} \markbox{236}{which} \markbox{237}{is} \markbox{238}{between} \markbox{239}{the} \markbox{240}{first} \markbox{241}{and} \markbox{242}{last} \markbox{243}{and} \markbox{244}{call} \markbox{245}{it} \markbox{246}{a} day---with \markbox{247}{the} \markbox{248}{exception} \markbox{249}{of} \markbox{250}{figure} source.

If \markbox{251}{a} \markbox{252}{rectangle} \markbox{253}{is} \markbox{254}{given} \markbox{255}{which} \markbox{256}{selects} \markbox{257}{the} \markbox{258}{caption} \markbox{259}{of} \markbox{260}{a} \markbox{261}{figure} \markbox{262}{that} \textit{shouldn't}\footnote{(fingers crossed)} \markbox{263}{intersect} \markbox{264}{any} \markbox{265}{word} \markbox{266}{rectangles} \markbox{267}{because} \markbox{268}{only} \markbox{269}{words} \markbox{270}{which} \markbox{271}{are} \markbox{272}{in} \markbox{273}{the} \markbox{274}{body} \markbox{275}{or} \markbox{276}{enunciations} \markbox{277}{or} \markbox{278}{proofs} \markbox{279}{or} \markbox{280}{the} \markbox{281}{bibliography} \markbox{282}{are} marked. \markbox{283}{So} \dots nice.

Right \markbox{284}{now} \markbox{285}{the} \markbox{286}{next} \markbox{287}{thing} \markbox{288}{I} \markbox{289}{need} \markbox{290}{to} \markbox{291}{do} is, though, \markbox{292}{is} \markbox{293}{actually} \markbox{294}{create} \markbox{295}{those} \markbox{296}{word} (and \markbox{297}{actually} \markbox{298}{also} \markbox{299}{inline} math, \markbox{300}{now} \markbox{301}{that} \markbox{302}{I} \markbox{303}{think} \markbox{304}{of} it) \markbox{305}{rectangles} \markbox{306}{and} \markbox{307}{draw} \markbox{308}{them} \markbox{309}{and} \markbox{310}{see} \markbox{311}{if} they're accurate.
\end{document}