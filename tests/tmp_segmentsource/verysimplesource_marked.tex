\documentclass{amsart}

\newwrite\markfile
\immediate\openout\markfile=boxpositions_verysimplesource.txt

\newcommand{\markbox}[2]{%
  \setbox0=\hbox{#2}%
  \immediate\write\markfile{#1:pwhd:\the\value{page}:\the\wd0:\the\ht0:\the\dp0}%
  \pdfsavepos
  \write\markfile{#1:spxy:\the\value{page}:\the\pdflastxpos:\the\pdflastypos:}%
  #2% 
  \pdfsavepos
  \write\markfile{#1:epxy:\the\value{page}:\the\pdflastxpos:\the\pdflastypos:}%
}

\begin{document}
Here \markbox{0}{is} \markbox{1}{just} \markbox{2}{some} \markbox{3}{straight} \markbox{4}{up} text, \markbox{5}{no} \markbox{6}{math} \markbox{7}{or} \markbox{8}{equations} \markbox{9}{or} anything. \markbox{10}{I} \markbox{11}{just} \markbox{12}{want} \markbox{13}{to} \markbox{14}{see} \markbox{15}{if} \markbox{16}{I} \markbox{17}{can} \markbox{18}{visualize} \markbox{19}{the} \markbox{20}{information} \markbox{21}{that} \markbox{22}{is} \markbox{23}{output} \markbox{24}{to} {\tt boxpositions\_\string{filename\string}.txt} \markbox{25}{without} \markbox{26}{writing} \markbox{27}{a} \markbox{28}{huge} \markbox{29}{file} \markbox{30}{and} \markbox{31}{drawing} \markbox{32}{a} \markbox{33}{bunch} \markbox{34}{of} \markbox{35}{rectangles} \markbox{36}{for} \markbox{37}{all} \markbox{38}{the} \markbox{39}{different} words. I'll \markbox{40}{also} \markbox{41}{need} \markbox{42}{to} \markbox{43}{think} \markbox{44}{a} \markbox{45}{little} \markbox{46}{more} \markbox{47}{clearly} \markbox{48}{on} \markbox{49}{how} \markbox{50}{exactly} \markbox{51}{I} \markbox{52}{intend} \markbox{53}{to} \markbox{54}{use} \markbox{55}{all} \markbox{56}{the} \markbox{57}{information} \markbox{58}{in} \markbox{59}{that} {\tt boxpositions\_\string{filename\string}.txt} file. Let's \markbox{60}{do} \markbox{61}{that} now---why not. \markbox{62}{So} \markbox{63}{in} \markbox{64}{theory} \markbox{65}{the} \markbox{66}{information} \markbox{67}{this} \markbox{68}{gives} \markbox{69}{me} is
\begin{enumerate}
\item the width, height, \markbox{70}{and} \markbox{71}{depth} \markbox{72}{of} \markbox{73}{words} \markbox{74}{in} \markbox{75}{the} \markbox{76}{source} \markbox{77}{that} \markbox{78}{are} \markbox{79}{not} \markbox{80}{inside} \markbox{81}{forbidden} \markbox{82}{environments} \markbox{83}{or} \markbox{84}{a} \markbox{85}{naked} \markbox{86}{block} \markbox{87}{and} \markbox{88}{are} \markbox{89}{surrounded} \markbox{90}{by} \markbox{91}{just} space, \markbox{92}{no} punctuation.
\item the \markbox{93}{start} \markbox{94}{and} \markbox{95}{end} \markbox{96}{x} \markbox{97}{and} \markbox{98}{y} \markbox{99}{coordinate} \markbox{100}{of} \markbox{101}{the} \markbox{102}{word} \markbox{103}{in} \markbox{104}{the} PDF: \markbox{105}{I} \markbox{106}{should} \markbox{107}{be} \markbox{108}{able} \markbox{109}{to} \markbox{110}{to} \markbox{111}{use} \markbox{112}{this} \markbox{113}{to} \markbox{114}{get} \markbox{115}{the} word's x0 \markbox{116}{and} x1 \markbox{117}{rectangle} \markbox{118}{in} \markbox{119}{the} PDF
\item the \markbox{120}{start} \markbox{121}{and} \markbox{122}{end} \markbox{123}{page} \markbox{124}{of} \markbox{125}{the} \markbox{126}{word} \markbox{127}{in} \markbox{128}{the} PDF
\end{enumerate}
I \markbox{129}{believe} \markbox{130}{the} \markbox{131}{start} \markbox{132}{and} \markbox{133}{end} \markbox{134}{y} \markbox{135}{coordinates} \markbox{136}{are} \markbox{137}{always} \markbox{138}{the} \markbox{139}{same} \markbox{140}{unless} \markbox{141}{the} \markbox{142}{word} \markbox{143}{spans} \markbox{144}{a} \markbox{145}{newline} \markbox{146}{or} pagebreak, \markbox{147}{which} \markbox{148}{might} \markbox{149}{be} \markbox{150}{worth} using? \markbox{151}{Or} \markbox{152}{maybe} I'll \markbox{153}{just} \markbox{154}{ignore} those? \markbox{155}{Ultimately} \markbox{156}{I} \markbox{157}{want} \markbox{158}{some} \markbox{159}{funciton} \markbox{m160}{$f$} \markbox{161}{where} \markbox{m162}{$f(\text{rectangle in PDF}) = $} \markbox{163}{the} \markbox{164}{source} \LaTeX{} \markbox{165}{which} \markbox{166}{created} and/or \markbox{167}{is} \markbox{168}{very} \markbox{169}{near} \markbox{170}{that} rectangle. So\dots.

Okay! \markbox{171}{This} \markbox{172}{might} \markbox{173}{be} overkill, \markbox{174}{but} \markbox{175}{we} \markbox{176}{could} \markbox{177}{do} \markbox{178}{something} \markbox{179}{like} this:
Given \markbox{180}{an} \markbox{181}{arbitrary} \markbox{182}{page} \markbox{183}{and} \markbox{184}{rectangle} \markbox{185}{specified} \markbox{186}{by} x0, y0, x1, y1 \markbox{187}{see} \markbox{188}{which} \markbox{189}{individual} \markbox{190}{word} \markbox{191}{rectangles} \markbox{192}{on} \markbox{193}{that} \markbox{194}{page} \markbox{195}{the} \markbox{196}{larger} \markbox{197}{rectangle} intersects.

Then \markbox{198}{identify} \markbox{199}{the} \markbox{200}{intersecting} \markbox{201}{word} \markbox{202}{rectangle} \markbox{203}{that} \markbox{204}{is} \markbox{205}{earliest} \markbox{206}{in} \markbox{207}{the} \markbox{208}{page} (smallest y0 \markbox{209}{then} x0---I \markbox{210}{believe} \markbox{211}{a} \markbox{212}{larger} \markbox{213}{y} \markbox{214}{coordinate} \markbox{215}{means} \markbox{216}{further} \markbox{217}{down} \markbox{218}{the} page; it's \markbox{219}{not} \markbox{220}{the} \markbox{221}{usual} \markbox{222}{cartesian} \markbox{223}{coordinate} system) \markbox{224}{and} \markbox{225}{the} \markbox{226}{one} \markbox{227}{which} \markbox{228}{is} \markbox{229}{last} \markbox{230}{in} \markbox{231}{the} \markbox{232}{page} (largest y1 \markbox{233}{and} \markbox{234}{then} \markbox{235}{largest} x1) \markbox{236}{and} \markbox{237}{then} \markbox{238}{just} \markbox{239}{grab} \markbox{240}{all} \markbox{241}{of} \markbox{242}{the} \LaTeX{} \markbox{243}{source} \markbox{244}{which} \markbox{245}{is} \markbox{246}{between} \markbox{247}{the} \markbox{248}{first} \markbox{249}{and} \markbox{250}{last} \markbox{251}{and} \markbox{252}{call} \markbox{253}{it} \markbox{254}{a} day---with \markbox{255}{the} \markbox{256}{exception} \markbox{257}{of} \markbox{258}{figure} source.

If \markbox{259}{a} \markbox{260}{rectangle} \markbox{261}{is} \markbox{262}{given} \markbox{263}{which} \markbox{264}{selects} \markbox{265}{the} \markbox{266}{caption} \markbox{267}{of} \markbox{268}{a} \markbox{269}{figure} \markbox{270}{that} \textit{shouldn't}\footnote{(fingers crossed)} \markbox{271}{intersect} \markbox{272}{any} \markbox{273}{word} \markbox{274}{rectangles} \markbox{275}{because} \markbox{276}{only} \markbox{277}{words} \markbox{278}{which} \markbox{279}{are} \markbox{280}{in} \markbox{281}{the} \markbox{282}{body} \markbox{283}{or} \markbox{284}{enunciations} \markbox{285}{or} \markbox{286}{proofs} \markbox{287}{or} \markbox{288}{the} \markbox{289}{bibliography} \markbox{290}{are} marked. \markbox{291}{So} \dots nice.

Right \markbox{292}{now} \markbox{293}{the} \markbox{294}{next} \markbox{295}{thing} \markbox{296}{I} \markbox{297}{need} \markbox{298}{to} \markbox{299}{do} is, though, \markbox{300}{is} \markbox{301}{actually} \markbox{302}{create} \markbox{303}{those} \markbox{304}{word} (and \markbox{305}{actually} \markbox{306}{also} \markbox{307}{inline} math, \markbox{308}{now} \markbox{309}{that} \markbox{310}{I} \markbox{311}{think} \markbox{312}{of} it) \markbox{313}{rectangles} \markbox{314}{and} \markbox{315}{draw} \markbox{316}{them} \markbox{317}{and} \markbox{318}{see} \markbox{319}{if} they're accurate.
\end{document}