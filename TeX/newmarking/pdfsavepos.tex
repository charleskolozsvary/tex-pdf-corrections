\documentclass{amsart}

\newwrite\posfile
\immediate\openout\posfile=positions.txt

\newcommand{\markstart}[1]{%
  \pdfsavepos
  \write\posfile{#1:start:\the\value{page}:\the\pdflastxpos:\the\pdflastypos}%
}

\newcommand{\markend}[1]{%
  \pdfsavepos
  \write\posfile{#1:end:\the\pdflastxpos:\the\pdflastypos}%
}

%% \newcommand{\markbox}[2]{%
%%   \setbox0=\hbox{#2}%
%%   \pdfsavepos\write\posfile{#1:\the\value{page}:\the\pdflastxpos:\the\pdflastypos:\the\wd0:\the\ht0:\the\dp0}%
%%   \box0
%% }

%% \newcommand{\markbox}[2]{%
%%   \setbox0=\hbox{#2}%
%%   \write\posfile{#1:\the\value{page}:\the\wd0:\the\ht0:\the\dp0}%
%%   \pdfsavepos
%%   \write\posfile{#1-pos:\the\pdflastxpos:\the\pdflastypos}%
%%   #2% typeset normally
%% }


\newcommand{\markbox}[2]{% better called markposition perhaps
  \setbox0=\hbox{#2}%
  \immediate\write\posfile{#1:whd{}:\the\value{page}:\the\wd0:\the\ht0:\the\dp0}%
  \pdfsavepos
  \write\posfile{#1:start:\the\value{page}:\the\pdflastxpos:\the\pdflastypos}%
  #2% typeset normally
  \pdfsavepos
  \write\posfile{#1:end{}:\the\value{page}:\the\pdflastxpos:\the\pdflastypos}%
}

\begin{document}
Text \markbox{0}{and} more \markbox{1}{text}.

Here is more text and a \markbox{2}{marked box}.

Here is a line and some math: \markbox{3}{$\displaystyle \sum^{n}_{i=0}\coprod^{\displaystyle \prod_{a \in \mathbb{A}}a\circ a^{-1}}b_{\alpha}^{-\beta}$} which is quite egregious. \markbox{4}{Anticipation} is high.

\vspace{16cm}

stuff at the very bottom which will go to the next page at perhaps not around this point but at some later point in this paragraph. wow what a long paragraph I wonder when this will go to the next page\dots . Will this ever go to the next page, man? stuff at the very bottom which will go to the next page at perhaps \markbox{break}{not this point} \markbox{afterbreak}{but} at some later point in this paragraph. wow what a long paragraph I wonder when this will go to the next page\dots . Will this ever go to the next page, man?
\[
\text{some display math} \prod_{x \in \mathbb{X}} x + iy
\]
\end{document}
